-- Exercício 1 --
CREATE TABLE PESSOA (
    ID_PESSOA NUMBER(4),
    NOME VARCHAR2(40),
    ENDERECO VARCHAR2(40)
);

CREATE TABLE FonePessoa (
    ID_PESSOA NUMBER(4),
    DDD VARCHAR2(2),
    PREFIXO VARCHAR2(4),
    NUMERO VARCHAR2(4)
);

CREATE TABLE ESTUDANTE (
    ID_ESTUDANTE NUMBER(4),
    EMAIL VARCHAR2(40),
    ID_PESSOA NUMBER(4),
    ID_REP NUMBER(4)
);

CREATE TABLE REPUBLICA (
    ID_REP NUMBER(4),
    NOME VARCHAR2(40),
    ENDERECO VARCHAR2(40)
);

-- Exercício 2 --
ALTER TABLE PESSOA
ADD CONSTRAINT PK_PESSOA PRIMARY KEY(ID_PESSOA);

ALTER TABLE FONEPESSOA
ADD CONSTRAINT PK_FONE_PESSOA PRIMARY KEY(DDD, PREFIXO, NUMERO);

ALTER TABLE FONEPESSOA
ADD CONSTRAINT FK_FONE_PESSOA FOREIGN KEY(ID_PESSOA) REFERENCES PESSOA(ID_PESSOA);

ALTER TABLE ESTUDANTE
ADD CONSTRAINT PK_ESTUDANTE PRIMARY KEY(ID_ESTUDANTE);

ALTER TABLE ESTUDANTE
ADD CONSTRAINT FK_ESTUDANTE_PESSOA FOREIGN KEY(ID_PESSOA) REFERENCES PESSOA(ID_PESSOA);

ALTER TABLE REPUBLICA
ADD CONSTRAINT PK_REP PRIMARY KEY(ID_REP);

ALTER TABLE ESTUDANTE
ADD CONSTRAINT FK_ESTUDANTE_REP FOREIGN KEY(ID_REP) REFERENCES REPUBLICA(ID_REP);

-- Exercício 3 --

-- PESSOAS
INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO)
VALUES (1, 'Leticia Meier', 'JATAIZINHO');

INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO)
VALUES (2, 'Eduardo Lacerda', 'JATAIZINHO');

INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO)
VALUES (3, 'Maria Fernanda', 'SERTANOPOLIS');

INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO)
VALUES (4, 'Ana Kataoka', 'LONDRINA');

INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO)
VALUES (5, 'Vinícios Lucas', 'LONDRINA');

INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO)
VALUES (6, 'Daniella Camargo', 'LONDRINA');

-- REPUBLICAS
INSERT INTO REPUBLICA (ID_REP, NOME, ENDERECO)
VALUES (100, 'REPUBLICA 1', 'R. Milton Felix');

INSERT INTO REPUBLICA (ID_REP, NOME, ENDERECO)
VALUES (200, 'REPUBLICA 2', 'R. Jandira de Azevedo');

-- ESTUDANTE
INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (1, 'LETICIA@GMAIL.COM', 1, NULL);

INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (2, 'EDUARDO@GMAIL.COM', 2, NULL);

INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (3, 'MARIA@GMAIL.COM', 3, NULL);

INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (4, 'ANA@GMAIL.COM', 4, NULL);

INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (5, 'VINICIUS@GMAIL.COM', 5, NULL);

INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (6, 'DANIELLA@GMAIL.COM', 6, NULL);

INSERT INTO FONEPESSOA (ID_PESSOA, DDD, PREFIXO, NUMERO)
VALUES (1, 43, 98, 1581);

INSERT INTO FONEPESSOA (ID_PESSOA, DDD, PREFIXO, NUMERO)
VALUES (2, 43, 98, 1281);

INSERT INTO FONEPESSOA (ID_PESSOA, DDD, PREFIXO, NUMERO)
VALUES (3, 43, 91, 2021);

INSERT INTO FONEPESSOA (ID_PESSOA, DDD, PREFIXO, NUMERO)
VALUES (4, 43, 91, 1815);

INSERT INTO FONEPESSOA (ID_PESSOA, DDD, PREFIXO, NUMERO)
VALUES (5, 43, 91, 1120);

INSERT INTO FONEPESSOA (ID_PESSOA, DDD, PREFIXO, NUMERO)
VALUES (6, 43, 91, 1522);

INSERT INTO FONEPESSOA (ID_PESSOA, DDD, PREFIXO, NUMERO)
VALUES (1, 43, 91, 6331);

-- Exercício 4 --
ALTER TABLE FONEPESSOA 
MODIFY PREFIXO VARCHAR2(5);

-- Exercício 5 --

-- PESSOA
INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO) VALUES (7, 'Maria Clara', 'IBIPORA');
INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO) VALUES (8, 'Fernando Yudi', 'LONDRINA');
INSERT INTO PESSOA (ID_PESSOA, NOME, ENDERECO) VALUES (9, 'Jorge Greorio', 'CAMBE');

-- ESTUDANTE
INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (7, 'mariaclara@edu.unifil.br', 7, 100);
INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (8, 'fernando@edu.unifil.br', 8, 200);
INSERT INTO ESTUDANTE (ID_ESTUDANTE, EMAIL, ID_PESSOA, ID_REP)
VALUES (9, 'jorge@edu.unifil.br', 9, 200);

SELECT R.NOME AS REPUBLICA, COUNT(E.ID_ESTUDANTE) AS QTD_ESTUDANTE FROM REPUBLICA R, ESTUDANTE E
WHERE (E.ID_REP = R.ID_REP) GROUP BY R.NOME;

-- Exercício 6 --
SELECT P.NOME, ('(' || F.DDD || ')' || F.PREFIXO || F.NUMERO) AS NUMERO FROM FONEPESSOA F, PESSOA P 
WHERE (F.ID_PESSOA = P.ID_PESSOA) ORDER BY P.NOME;

-- Exercício 7 --
SELECT P.NOME, P.ENDERECO FROM PESSOA P WHERE NOT EXISTS 
(SELECT 1 FROM FONEPESSOA F WHERE F.ID_PESSOA = P.ID_PESSOA) 
ORDER BY P.NOME;

-- Exercício 8 -- ERROR
SELECT R.NOME, R.ENDERECO
FROM REPUBLICA R, ESTUDANTE E
WHERE R.ID_REP = E.ID_REP and R.ID_REP = (
    SELECT MAX((SELECT COUNT(ID_REP) from REPUBLICA where R.ID_REP = E.ID_REP))
    from REPUBLICA R, ESTUDANTE E
    WHERE R.ID_REP = E.ID_REP
    )
GROUP BY R.NOME, R.ENDERECO;

-- Exercício 9 --
SELECT E.ID_ESTUDANTE, E.EMAIL, P.NOME, P.ENDERECO
FROM PESSOA P, ESTUDANTE e 
WHERE E.ID_REP is null and E.ID_PESSOA = P.ID_PESSOA;

-- Exercício 10 --
SELECT P.ID_PESSOA, P.NOME, P.ENDERECO
FROM FONEPESSOA F, PESSOA P
MINUS
SELECT P.ID_PESSOA, P.NOME, P.ENDERECO
FROM FONEPESSOA F, PESSOA P
WHERE F.ID_PESSOA = P.ID_PESSOA
ORDER BY NOME;

-- Exercício 11 --
INSERT INTO PESSOA VALUES(10, 'Emmanuele', 'LONDRINA');
SELECT P.NOME, P.ENDERECO
FROM PESSOA P, ESTUDANTE E
WHERE P.ID_PESSOA = E.ID_PESSOA
INTERSECT
SELECT NOME, ENDERECO
FROM PESSOA
ORDER BY ENDERECO;

-- Exercício 12 --
SELECT ID_PESSOA,'Pessoa' tipo, NOME, ENDERECO
FROM PESSOA
UNION
SELECT ID_REP,'Republica' tipo, NOME, ENDERECO
FROM REPUBLICA;